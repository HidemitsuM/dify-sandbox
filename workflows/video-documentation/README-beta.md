# Video Documentation Workflow Beta版

## 概要

Video Documentation WorkflowのBeta版です。追加ファイル（スライド、スプレッドシート等）を投入可能で、事実確認・精度向上を行います。

## 通常版との違い

| 機能 | 通常版 | Beta版 |
|------|--------|--------|
| 動画からのドキュメント生成 | ✓ | ✓ |
| スナップショット抽出 | ✓ | ✓ |
| 文字起こし | ✓ | ✓ |
| 画像分析 | ✓ | ✓ |
| アクションアイテム抽出 | ✓ | ✓ |
| **追加ファイル入力** | - | ✓ |
| **事実確認・精度向上** | - | ✓ |
| **検証済み情報のマーク** | - | ✓ |

## 入力パラメータ

| パラメータ | 型 | 必須 | デフォルト | 説明 |
|-----------|----|----|-----------|------|
| `video_file` | file | ✓ | - | 動画ファイル（MP4、MOV等） |
| `additional_files` | file-list | - | [] | 追加ファイル（スライド、スプレッドシート等） |
| `file_descriptions` | paragraph | - | - | 各ファイルの説明（オプション） |
| `interval_seconds` | number | - | 90 | スナップショット間隔（秒） |
| `context_range` | number | - | 30 | コンテキスト範囲（秒） |

## 追加ファイルの扱い

### 入力方法

- オプション（複数可、最大10ファイル）
- ファイル名で自動的に意味を推測
- `file_descriptions` で手動で説明を追加可能

### サポートされるファイル形式

- **スライド**: PowerPoint、PDF、画像
- **スプレッドシート**: Excel、CSV
- **ドキュメント**: Word、PDF、テキスト
- **画像**: PNG、JPG、その他画像形式

### 処理内容

1. **ファイル解析**: LLMが各ファイルの内容を要約・分析
2. **事実確認**: 動画の要約結果と追加ファイルを照合
3. **精度向上**: 追加ファイルから新たな情報を抽出し、要約を補完・修正
4. **信頼度付与**: 検証済み情報に信頼度レベル（high/medium/low）を付与

## 出力構造

### 追加ファイルなしの場合（通常版と同じ）

```markdown
# 動画ドキュメント

## メタデータ
- 動画長
- セグメント数
- 重要セグメント数

## 目次

## セグメント詳細

## アクションアイテム

## 完全な文字起こし
```

### 追加ファイルありの場合（Beta版特有）

```markdown
# 動画ドキュメント（検証済み版）

## メタデータ
- 動画長
- セグメント数
- 重要セグメント数
- **検証済み: ✓ 追加ファイルに基づく事実確認完了**

## 追加ファイル情報  # Beta版で追加
- ファイル名
- ファイルタイプ
- 関連トピック
- 内容要約
- キーポイント
- 抽出データ

## 目次

## セグメント詳細（検証済み）
- **✓ 検証済み情報**  # Beta版で追加
  - 信頼度レベル
  - 出典ファイル

## 追加情報（ファイルから抽出）  # Beta版で追加
- トピック別の追加情報

## 修正履歴  # Beta版で追加
- 元の内容 vs 修正内容
- 修正理由

## アクションアイテム

## 完全な文字起こし
```

## ワークフロー図

```
Start（動画 + オプションで追加ファイル）
    ↓
[動画処理]
    ├─ 音声抽出 → 文字起こし ──┐
    └─ スナップショット抽出 ────┤
                                 ↓
                           [データ紐付け]
                                 ↓
                           [バッチ分割]
                                 ↓
                           [バッチ処理] (並列)
                                 ↓
                           [画像分析]
                                 ↓
                           [重要度スコア計算]
                                 ↓
                           [結果収集]
                                 ↓
                           [アクションアイテム抽出]
                                 ↓
                    If-Else: 追加ファイルがあるか？
                    ├─ (あり) → [追加ファイル解析]
                    │           ↓
                    │         [事実確認・精度向上]
                    │           ↓
                    │         [Template Transform Beta]
                    │
                    └─ (なし) → [Template Transform Original]
                                 ↓
                              End
```

## LLMノード詳細

### LLMノード4: 追加ファイル解析

**目的**: 追加ファイルの内容を要約・分析

**出力形式**:
```json
{
  "additional_files": [
    {
      "filename": "sales_data.xlsx",
      "file_type": "spreadsheet",
      "content_summary": "Q4売上データ",
      "key_points": ["売上増加20%", "新規顧客獲得"],
      "related_topic": "売上報告",
      "data_extracted": {"q4_sales": "1.2億円", "growth": "+20%"}
    }
  ]
}
```

### LLMノード5: 事実確認・精度向上

**目的**: 元の要約と追加ファイルを照合し、検証・修正

**出力形式**:
```json
{
  "verification_results": [
    {
      "segment_id": 1,
      "original": "売上が増加した",
      "verified": "売上が20%増加した（Q4売上スプレッドシートより確認）",
      "confidence": "high",
      "source": "sales_data.xlsx"
    }
  ],
  "additional_info": [
    {
      "topic": "売上報告",
      "info": "具体的な売上数値: 1.2億円",
      "source": "sales_data.xlsx"
    }
  ],
  "corrections": [
    {
      "segment_id": 3,
      "original": "新規顧客5人",
      "corrected": "新規顧客50人",
      "reason": "スプレッドシートのデータに基づき修正"
    }
  ]
}
```

## 使用例

### 例1: スライドがある場合

**入力**:
- 動画ファイル: `meeting.mp4`
- 追加ファイル: `presentation.pptx`（会議で使用されたスライド）

**効果**:
- スライドの内容が解析され、動画の要約と照合される
- スライドに含まれる数値や情報が検証される
- スライドからの追加情報がドキュメントに含まれる

### 例2: スプレッドシートがある場合

**入力**:
- 動画ファイル: `sales_review.mp4`
- 追加ファイル: `q4_sales.xlsx`（売上データ）

**効果**:
- 発表された売上数値がスプレッドシートと照合される
- 具体的な数値が補完される
- 「売上が増加」→「売上が20%増加（1.2億円）」のように精度が向上

### 例3: 複数ファイルがある場合

**入力**:
- 動画ファイル: `project_review.mp4`
- 追加ファイル:
  - `slides.pptx`
  - `budget.xlsx`
  - `timeline.pdf`

**効果**:
- 各ファイルが分析され、関連するトピックに紐付けられる
- 複数のソースから情報が統合される
- より包括的で正確なドキュメントが生成される

## 技術仕様

### モデル

- **LLMノード1（文字起こし）**: Gemini 2.5 Flash
- **LLMノード2（画像分析）**: Gemini 2.5 Flash + Vision
- **LLMノード3（アクションアイテム）**: Gemini 2.5 Flash
- **LLMノード4（追加ファイル解析）**: Gemini 2.5 Flash + Vision
- **LLMノード5（事実確認）**: Gemini 2.5 Flash

### バッチ処理

- 画像は16セグメントずつバッチ処理
- 並列処理で高速化

### 制限事項

- 追加ファイル: 最大10ファイル
- 動画長: 推奨2時間以内
- スナップショット間隔: 10-600秒

## 導入方法

1. Difyプラットフォームにログイン
2. 「ワークフローを作成」を選択
3. 「DSLからインポート」を選択
4. `workflow-beta.yml` ファイルをアップロード
5. 必要なモデルプロバイダー（Google）を設定

## フィードバック

Beta版のため、バグや改善提案をお待ちしています。

## ライセンス

通常版と同じライセンスが適用されます。
